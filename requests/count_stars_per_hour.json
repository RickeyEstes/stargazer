[
  {
    "$match": {
      "repository_path": "REPO_PATH"
    }
  },
  {
    "$project": {
      "starred_at": {
        "$dateFromString": {
          "dateString": "$data.starred_at"
        }
      }
    }
  },
  {
    "$project": {
      "starred_at": "$starred_at",
      "year": {
        "$toString": {
          "$year": "$starred_at"
        }
      },
      "month": {
        "$toString": {
          "$month": "$starred_at"
        }
      },
      "day": {
        "$toString": {
          "$dayOfMonth": "$starred_at"
        }
      },
      "hour": {
        "$toString": {
          "$hour": "$starred_at"
        }
      }
    }
  },
  {
    "$project": {
      "starred_at": "$starred_at",
      "date": {
        "$dateFromString": {
          "dateString": {
            "$concat": [
              "$year",
              "-",
              "$month",
              "-",
              "$day",
              "T",
              "$hour",
              ":0:0"
            ]
          }
        }
      }
    }
  },
  {
    "$sort": {
      "starred_at": -1
    }
  },
  {
    "$group": {
      "_id": "$date",
      "count": {
        "$sum": 1
      }
    }
  },
  {
    "$sort": {
      "_id": -1
    }
  },
  {
    "$limit": 80
  }
]